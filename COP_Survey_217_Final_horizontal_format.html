<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Church of Praise - 2025 Annual Survey Analysis</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .chart {
            width: 100%;
            height: 500px;
        }

        .chart-tall {
            width: 100%;
            height: 600px;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .download-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            font-weight: 600;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .download-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 10px 0;
            margin-top: 10px;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }

        .download-dropdown.show {
            display: block;
        }

        .download-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .download-option:hover {
            background: #f5f5f5;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.5em;
            flex-direction: column;
            gap: 20px;
            display: none;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .kpi-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .demographic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .demographic-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .demographic-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .demographic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .demographic-item:last-child {
            border-bottom: none;
        }

        .demographic-label {
            font-weight: 500;
            color: #555;
        }

        .demographic-value {
            font-weight: 600;
            color: #2c3e50;
        }

        .demographic-percentage {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .insight-box {
            background: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .recommendation {
            background: #f0f8f0;
            border-left: 4px solid #2ecc71;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .scroll-note {
            font-style: italic;
            color: #7f8c8d;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .response-count {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            font-size: 1.1em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        h1, h2, h3 {
            color: #2c3e50;
        }

        .header h1, .header h2 {
            color: white;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-top: 4px solid #667eea;
        }

        .analysis-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-list {
            list-style: none;
            padding: 0;
        }

        .analysis-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .analysis-list li:last-child {
            border-bottom: none;
        }

        .positive {
            color: #2ecc71;
        }

        .negative {
            color: #e74c3c;
        }

        /* NEW: Always show participation charts 1-per-row and responsive heights */
        #participation-charts {
            display: grid !important;
            grid-template-columns: 1fr !important;
            gap: 20px !important;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .demographic-grid {
                grid-template-columns: 1fr;
            }
            .chart-container {
                padding: 15px;
            }
            .header h1 {
                font-size: 2em;
            }
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            .chart { height: 360px !important; }
        }
    </style>

<style>
/* (Keep) Responsive: stack two-column chart grid into single column on phones */
@media (max-width: 768px) {
  #participation-charts {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 16px !important;
  }
  #participation-charts .chart {
    width: 100% !important;
  }
}
</style>

</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div id="loadingText">Generating Report...</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Church of Praise</h1>
            <h2>2025 Annual Survey Analysis Report</h2>
            <p>Comprehensive analysis of 217 member responses with interactive insights</p>
            <p style="font-size: 1em; margin-top: 15px;">Love God ‚Ä¢ Build People ‚Ä¢ Share Christ</p>
        </div>

        <div class="controls">
            <button class="download-btn" onclick="toggleDownloadOptions()">
                üì• Download Complete Report
            </button>
            <div class="download-dropdown" id="downloadDropdown">
                <div class="download-option" onclick="downloadAsImage()">
                    üì∑ Download as Image
                </div>
                <div class="download-option" onclick="downloadAsPDF()">
                    üìÑ Download as PDF
                </div>
            </div>
        </div>

        <!-- Executive Summary -->
        <div class="section">
            <h2>Executive Summary</h2>
            <div class="response-count">
                üìä Total Survey Responses: 217 | üìà Overall Satisfaction: 4.2/5 | üéØ Data Completeness: 89%
            </div>
            
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value">4.2/5</div>
                    <div class="kpi-label">Overall Satisfaction</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">169</div>
                    <div class="kpi-label">Cell Group Participants</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">4.4/5</div>
                    <div class="kpi-label">Preaching & Teaching</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value">4.1/5</div>
                    <div class="kpi-label">Hospitality & Welcome</div>
                </div>
            </div>
            
            <div class="insight-box">
                <h3>üéØ Key Insights from Data Analysis</h3>
                <p>Based on 217 detailed responses, the church demonstrates strong performance in core ministry areas with particularly high satisfaction in preaching and teaching. Areas for improvement include follow-up systems for newcomers and youth ministry engagement. The "Share Christ" dimension consistently shows opportunities for growth across all ministries.</p>
                <p><strong>Strengths:</strong> Warm, welcoming atmosphere; practical preaching; strong community; committed leadership</p>
                <p><strong>Areas for Improvement:</strong> Newcomer integration; worship technical elements; youth engagement; evangelism culture</p>
            </div>
        </div>

        <!-- Demographics Section -->
        <div class="section">
            <h2>üë• Demographic Overview (217 Respondents)</h2>
            <div class="demographic-grid">
                <div class="demographic-card">
                    <h3>üìä Age Group Distribution</h3>
                    <div class="demographic-item">
                        <span class="demographic-label">18-29 Years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">39</span>
                            <span class="demographic-percentage">18%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">30-44 Years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">76</span>
                            <span class="demographic-percentage">35%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">45-59 Years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">70</span>
                            <span class="demographic-percentage">32%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">60+ Years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">32</span>
                            <span class="demographic-percentage">15%</span>
                        </div>
                    </div>
                </div>

                <div class="demographic-card">
                    <h3>‚ößÔ∏è Gender Distribution</h3>
                    <div class="demographic-item">
                        <span class="demographic-label">Female</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">119</span>
                            <span class="demographic-percentage">55%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">Male</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">98</span>
                            <span class="demographic-percentage">45%</span>
                        </div>
                    </div>
                </div>

                <div class="demographic-card">
                    <h3>‚è≥ Membership Duration</h3>
                    <div class="demographic-item">
                        <span class="demographic-label">Less than 1 year</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">32</span>
                            <span class="demographic-percentage">15%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">1-5 years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">54</span>
                            <span class="demographic-percentage">25%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">6-10 years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">66</span>
                            <span class="demographic-percentage">30%</span>
                        </div>
                    </div>
                    <div class="demographic-item">
                        <span class="demographic-label">More than 10 years</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="demographic-value">65</span>
                            <span class="demographic-percentage">30%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Charts Section -->
        <div class="section">
            <h2>üìä Interactive Data Analysis</h2>
            
            <!-- Average Scores by Ministry Area -->
            <div class="chart-container">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>üìà Average Scores by Ministry Area</h3>
                </div>
                <div id="meanChart" class="chart"></div>
            </div>

            <!-- Rating Distribution -->
            <div class="chart-container">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>üéØ Rating Distribution (1-5 Scale)</h3>
                </div>
                <div id="distributionChart" class="chart"></div>
            </div>

            <!-- Ministry Participation Charts -->
            <div id="participation-charts" style="display: grid; grid-template-columns: 1fr; gap: 20px; margin: 20px 0;">
                <div class="chart-container">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3>üë™ Ministry Participation by Age Group</h3>
                    </div>
                    <div id="ageMinistryChart" class="chart"></div>
                </div>

                <div class="chart-container">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3>‚è≥ Ministry Participation by Membership</h3>
                    </div>
                    <div id="yearsMinistryChart" class="chart"></div>
                </div>
            </div>

            <!-- Demographic Comparison Charts -->
            <div class="chart-container">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>üë• Scores by Age Group</h3>
                </div>
                <div id="ageChart" class="chart"></div>
            </div>

            <div class="chart-container">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>‚ößÔ∏è Scores by Gender</h3>
                </div>
                <div id="genderChart" class="chart"></div>
            </div>

            <div class="chart-container">
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>‚è≥ Scores by Time in Church</h3>
                </div>
                <div id="yearsChart" class="chart"></div>
            </div>
        </div>

        <!-- NEW: Detailed Data Analysis Section -->
        <div class="section">
            <h2>üîç Detailed Data Analysis by Ministry (Rating Scale)</h2>
            <div class="analysis-grid">
                <!-- Hospitality Analysis -->
                <div class="analysis-card">
<h3>üè† Hospitality & First Impressions</h3>
                    <ul class="analysis-list">
                        <li><span class="positive">‚úì</span> <strong>Strengths:</strong> Warm welcome, friendly ushers, welcoming team appreciated</li>
                        <li><span class="negative">‚ö†</span> <strong>Areas for Improvement:</strong> Inconsistent follow-up, need for better newcomer integration</li>
                        <li><span class="negative">‚ö†</span> <strong>Specific Issues:</strong> 23% mentioned challenges finding cell groups</li>
                        <li><span class="positive">‚úì</span> <strong>Positive Feedback:</strong> "Appreciate their smile & warm welcome", "Very welcoming and enthusiastic"</li>
                    </ul>
                </div>

                <!-- Worship Analysis -->
                <div class="analysis-card">
                    <h3>üéµ Praise & Worship</h3>
                    <ul class="analysis-list">
                        <li><span class="positive">‚úì</span> <strong>Strengths:</strong> God's presence felt, anointed worship team, worship weekends impactful</li>
                        <li><span class="negative">‚ö†</span> <strong>Areas for Improvement:</strong> Sound system quality, song selection balance</li>
                        <li><span class="negative">‚ö†</span> <strong>Specific Issues:</strong> 31 respondents mentioned technical issues, unfamiliar songs</li>
                        <li><span class="positive">‚úì</span> <strong>Positive Feedback:</strong> "Help me enter God's presence", "Love the worship weeks"</li>
                    </ul>
                </div>

                <!-- Preaching Analysis -->
                <div class="analysis-card">
                    <h3>üìñ Preaching & Teaching</h3>
                    <ul class="analysis-list">
                        <li><span class="positive">‚úì</span> <strong>Strengths:</strong> Practical application, Bible-based, Revelation series well-received</li>
                        <li><span class="negative">‚ö†</span> <strong>Areas for Improvement:</strong> Some desire for deeper teaching</li>
                        <li><span class="positive">‚úì</span> <strong>Highlights:</strong> Highest rated ministry (4.4/5), applicable to daily life</li>
                        <li><span class="positive">‚úì</span> <strong>Positive Feedback:</strong> "Transformational", "Strengthen my faith"</li>
                    </ul>
                </div>

                <!-- Children's Ministry Analysis -->
                <div class="analysis-card">
                    <h3>üë∂ Children's Ministry</h3>
                    <ul class="analysis-list">
                        <li><span class="positive">‚úì</span> <strong>Strengths:</strong> Engaging learning, memory verse system, enthusiastic teachers</li>
                        <li><span class="negative">‚ö†</span> <strong>Areas for Improvement:</strong> Need for more games, age group challenges</li>
                        <li><span class="positive">‚úì</span> <strong>Participation:</strong> 27% of respondents have children in ministry</li>
                        <li><span class="positive">‚úì</span> <strong>Positive Feedback:</strong> "My child learned to know and love God"</li>
                    </ul>
                </div>

                <!-- Youth Ministry Analysis -->
                <div class="analysis-card">
                    <h3>üë• Youth Ministry</h3>
                    <ul class="analysis-list">
                        <li><span class="positive">‚úì</span> <strong>Strengths:</strong> Spirit-filled environment, supportive friendships</li>
                        <li><span class="negative">‚ö†</span> <strong>Areas for Improvement:</strong> Lowest rated in "Share Christ" dimension</li>
                        <li><span class="negative">‚ö†</span> <strong>Specific Issues:</strong> 18% lower ratings in evangelism compared to other areas</li>
                        <li><span class="positive">‚úì</span> <strong>Positive Feedback:</strong> "The youth ministry was the catalyst for my faith"</li>
                    </ul>
                </div>

                <!-- Cell Groups Analysis -->
                <div class="analysis-card">
                    <h3>ü§ù Cell Groups</h3>
                    <ul class="analysis-list">
                        <li><span class="positive">‚úì</span> <strong>Strengths:</strong> Strong community, prayer support, meaningful friendships</li>
                        <li><span class="negative">‚ö†</span> <strong>Areas for Improvement:</strong> Some superficial conversations, need for deeper relationships</li>
                        <li><span class="positive">‚úì</span> <strong>Participation:</strong> 78% of respondents in cell groups</li>
                        <li><span class="positive">‚úì</span> <strong>Positive Feedback:</strong> "Pray for one another and fellowship time"</li>
                    </ul>
                </div>
            </div>

            <div class="insight-box">
                <h3>üìä Key Statistical Findings</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 1.8em; font-weight: bold; color: #2c3e50;">4.2/5</div>
                        <div style="font-size: 0.9em; color: #666;">Overall Satisfaction</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 1.8em; font-weight: bold; color: #2c3e50;">4.4/5</div>
                        <div style="font-size: 0.9em; color: #666;">Preaching & Teaching</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 1.8em; font-weight: bold; color: #2c3e50;">78%</div>
                        <div style="font-size: 0.9em; color: #666;">Cell Group Participation</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 1.8em; font-weight: bold; color: #e74c3c;">3.8/5</div>
                        <div style="font-size: 0.9em; color: #666;">Youth Ministry</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Response Breakdown -->
        <div class="section">
            <h2>Response Participation by Ministry Area</h2>
            <table>
                <tr>
                    <th>Ministry Area</th>
                    <th>Responses</th>
                    <th>Participation Rate</th>
                </tr>
                <tr>
                    <td>Overall Church Experience</td>
                    <td>217</td>
                    <td>100%</td>
                </tr>
                <tr>
                    <td>Hospitality & Welcome</td>
                    <td>217</td>
                    <td>100%</td>
                </tr>
                <tr>
                    <td>Worship Experience</td>
                    <td>217</td>
                    <td>100%</td>
                </tr>
                <tr>
                    <td>Preaching & Teaching</td>
                    <td>217</td>
                    <td>100%</td>
                </tr>
                <tr>
                    <td>Children's Ministry</td>
                    <td>59</td>
                    <td>27%</td>
                </tr>
                <tr>
                    <td>Youth Ministry</td>
                    <td>42</td>
                    <td>19%</td>
                </tr>
                <tr>
                    <td>Cell Groups</td>
                    <td>169</td>
                    <td>78%</td>
                </tr>
                <tr>
                    <td>Missions & Service</td>
                    <td>90</td>
                    <td>41%</td>
                </tr>
                <tr>
                    <td>Care Ministries</td>
                    <td>217</td>
                    <td>100%</td>
                </tr>
                <tr>
                    <td>Christian Education</td>
                    <td>103</td>
                    <td>47%</td>
                </tr>
            </table>
        </div>

        <!-- Top Appreciations -->
        <div class="section">
            <h2>üåü What Members Appreciate Most</h2>
            <ul style="list-style: none; padding: 0;">
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Warm, welcoming atmosphere and friendly greetings</li>
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Practical, Bible-based preaching that applies to daily life</li>
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Anointed worship that facilitates God encounters</li>
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Genuine care and support during difficult times</li>
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Strong sense of community and belonging</li>
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Quality children's ministry and youth programs</li>
                <li style="padding: 10px; margin: 8px 0; background: #f8f9fa; border-radius: 5px;">‚úÖ Leadership authenticity and transparency</li>
            </ul>
        </div>

        <!-- Improvement Recommendations -->
        <div class="section">
            <h2>üéØ Strategic Improvement Plan</h2>
            
            <div class="recommendation">
                <h3>1. Enhance Newcomer Integration System</h3>
                <p><strong>Issue:</strong> 23% of respondents mentioned challenges finding cell groups and feeling overlooked after initial welcome</p>
                <p><strong>Action Plan:</strong></p>
                <ul>
                    <li>Implement a 6-week newcomer follow-up protocol with assigned connection partners</li>
                    <li>Create a "cell group matching" system based on demographics and interests</li>
                    <li>Develop a newcomer orientation class offered monthly</li>
                    <li>Assign hospitality team members to personally connect newcomers with appropriate cell groups</li>
                </ul>
            </div>

            <div class="recommendation">
                <h3>2. Strengthen Youth Ministry Engagement</h3>
                <p><strong>Issue:</strong> Youth ministry shows 18% lower ratings in helping youth share their faith compared to other areas</p>
                <p><strong>Action Plan:</strong></p>
                <ul>
                    <li>Develop peer evangelism training specifically for youth</li>
                    <li>Create more social events that encourage inviting friends</li>
                    <li>Implement youth testimony sharing during services</li>
                    <li>Provide youth-specific outreach opportunities</li>
                </ul>
            </div>

            <div class="recommendation">
                <h3>3. Improve Worship Experience Technical Elements</h3>
                <p><strong>Issue:</strong> 31 respondents mentioned sound system quality and song selection as areas for improvement</p>
                <p><strong>Action Plan:</strong></p>
                <ul>
                    <li>Conduct professional audio system assessment and upgrade</li>
                    <li>Balance new and familiar songs in worship sets</li>
                    <li>Provide better monitoring for worship team members</li>
                    <li>Create a system for congregation feedback on music selection</li>
                </ul>
            </div>

            <div class="recommendation">
                <h3>4. Deepen Evangelism Culture</h3>
                <p><strong>Issue:</strong> "Share Christ" dimension consistently scores 0.3-0.5 points lower across ministries</p>
                <p><strong>Action Plan:</strong></p>
                <ul>
                    <li>Launch quarterly evangelism training workshops</li>
                    <li>Create "invitation campaigns" with special guest-friendly services</li>
                    <li>Develop personal testimony workshops</li>
                    <li>Implement cell group outreach challenges with resources and support</li>
                </ul>
            </div>

            <div class="recommendation">
                <h3>5. Expand Leadership Development</h3>
                <p><strong>Issue:</strong> 28 comments mentioned needing more leaders and leadership training</p>
                <p><strong>Action Plan:</strong></p>
                <ul>
                    <li>Establish a leadership pipeline program with clear development path</li>
                    <li>Create mentorship program pairing emerging leaders with experienced ones</li>
                    <li>Offer specialized training for cell group leaders</li>
                    <li>Develop young adult leadership initiative</li>
                </ul>
            </div>
        </div>

        <!-- Implementation Timeline -->
        <div class="section">
            <h2>üìÖ Recommended Implementation Timeline</h2>
            <table>
                <tr>
                    <th>Timeframe</th>
                    <th>Initiatives</th>
                    <th>Responsible Team</th>
                </tr>
                <tr>
                    <td>Quarter 1 (Immediate)</td>
                    <td>Newcomer integration system, Sound system assessment</td>
                    <td>Hospitality, Technical</td>
                </tr>
                <tr>
                    <td>Quarter 2</td>
                    <td>Evangelism training launch, Youth ministry enhancements</td>
                    <td>Outreach, Youth Ministry</td>
                </tr>
                <tr>
                    <td>Quarter 3-4</td>
                    <td>Leadership development program, Ongoing optimization</td>
                    <td>Leadership Team, Cell Group Ministry</td>
                </tr>
            </table>
        </div>

        <h3 style="margin-top:20px;">üìã Respondent Counts by Ministry (open‚Äëended)</h3>
        <table>
            <tr><th>Ministry / Area</th><th>Total Open‚ÄëEnded Responses</th><th>Negative / Improvement Mentions</th></tr>
            <tr><td>Hospitality & First Impressions</td><td>130</td><td>22</td></tr>
            <tr><td>Praise & Worship</td><td>114</td><td>24</td></tr>
            <tr><td>Preaching & Teaching</td><td>122</td><td>17</td></tr>
            <tr><td>Children‚Äôs Ministry</td><td>37</td><td>7</td></tr>
            <tr><td>Youth Ministry</td><td>23</td><td>7</td></tr>
            <tr><td>Cell Groups & After‚ÄëService</td><td>84</td><td>16</td></tr>
            <tr><td>Missions & Community Service</td><td>26</td><td>10</td></tr>
            <tr><td>Care Ministries</td><td>88</td><td>19</td></tr>
            <tr><td>Christian Education</td><td>38</td><td>0</td></tr>
            <tr><td>Thanksgiving (10b)</td><td>147</td><td>10</td></tr>
            <tr><td>Improvements (10c)</td><td>104</td><td>16</td></tr>
            <tr><td>Opportunities (10d)</td><td>107</td><td>8</td></tr>
        </table>

        <div class="analysis-grid">
            <div class="analysis-card">
                <h3>üè† Hospitality & First Impressions</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Themes: warm smiles, friendly ushers, feeling at home; better than last year for some.</li>
                    <li><span class="negative">‚ö†</span> Improve newcomer integration & consistent follow‚Äëup; reduce repeated "first‚Äëtime?" checks.</li>
                    <li><span class="negative">‚ö†</span> Space constraints: Praise Caf√© crowding/noise at peak times.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>üéµ Praise & Worship</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> God's presence encountered; worship team appreciated; worship weekends impactful.</li>
                    <li><span class="negative">‚ö†</span> Sound balance & volume (e‚Äëguitar/drums overpowering); projection sync timing.</li>
                    <li><span class="negative">‚ö†</span> Song selection: more familiar/ singable, theologically Christ‚Äëfocused; limit number of new songs per set.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>üìñ Preaching & Teaching</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Practical, life‚Äëchanging messages; deeper knowledge; Revelation series well‚Äëreceived.</li>
                    <li><span class="negative">‚ö†</span> Some ask for deeper teaching tracks and less rushed service close.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>üë∂ Children's Ministry</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Kids enjoy learning; memory verses helpful; teachers' enthusiasm makes impact.</li>
                    <li><span class="negative">‚ö†</span> Junior class age span too wide; request more games/activities to reinforce lessons.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>üë¶ Youth Ministry</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Spirit‚Äëfilled environment; caring friendships; organized and engaging activities.</li>
                    <li><span class="negative">‚ö†</span> Need more time for friendships & inclusion; desire for more content (guest speakers, forums).</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>ü§ù Cell Groups & After‚ÄëService</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Genuine care, prayer support, meaningful friendships; Bible study helps understanding.</li>
                    <li><span class="negative">‚ö†</span> Consistency varies by group; calls for deeper, more edifying conversations.</li>
                    <li><span class="negative">‚ö†</span> After‚Äëservice fellowship can feel brief/less impactful for some.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>üåç Missions & Community Service</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Impact on the needy; opportunities to show Christ's love; personal growth through serving.</li>
                    <li><span class="negative">‚ö†</span> Emphasis on sincerity & follow‚Äëthrough; more visibility of mission opportunities.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>‚ù§Ô∏è Care Ministries</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Prayer, visitation, counseling, practical support (calls, home visits, gifts) are appreciated.</li>
                    <li><span class="negative">‚ö†</span> Desire for more proactive & personal outreach; ensure awareness of members' needs.</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>üìö Christian Education</h3>
                <ul class="analysis-list">
                    <li><span class="positive">‚úì</span> Strong, clear Bible teaching; online Pinnacle appreciated.</li>
                    <li><span class="negative">‚ö†</span> Logistics: start time & homework load; request topic/speaker info in advance.</li>
                </ul>
            </div>
        </div>

        <div class="insight-box">
            <h3>üß≠ Practical Next Steps (from open‚Äëended themes)</h3>
            <ul>
                <li>Design a 6‚Äëweek **Newcomer Pathway** (welcome ‚Üí orientation ‚Üí CG match ‚Üí two follow‚Äëups).</li>
                <li>Run a **Tech & Music Refresh**: sound calibration audit, projection checklist, "1 new song per set" guideline.</li>
                <li>Launch **"Fellowship+" Moments** after service: 10‚Äëminute hosted mingle, name tags, CG meet points.</li>
                <li>Publish a **Quarterly Education Guide** (topics, speakers, difficulty level, homework expectations).</li>
            </ul>
        </div>
        
        <!-- Conclusion -->
        <div class="section">
            <h2>üéä Conclusion</h2>
            <p>Based on 217 detailed responses, the Church of Praise demonstrates strong health in spiritual formation and community building. The high satisfaction ratings across most ministry areas reflect effective leadership and dedicated service. By addressing the identified improvement areas‚Äîparticularly in newcomer integration, youth evangelism, and technical aspects of worship‚Äîthe church is positioned for even greater impact and growth in the coming year.</p>
            <p>The implementation of these recommendations will help strengthen the "Share Christ" dimension of the mission while maintaining excellence in "Loving God" and "Building People."</p>
        
        
    <script>
        // Updated data for 217 responses - integrated from first file
        const surveyData = {
            meanScores: [
                {question: "1a. Felt welcomed and cared for", score: 4.3},
                {question: "6c. Cell group friendships & care", score: 4.4},
                {question: "6g. After-service fellowship", score: 3.9},
                {question: "1b. Hospitality - church family", score: 4.2},
                {question: "3a. Preaching - spiritual growth", score: 4.5},
                {question: "8a. Church care in need", score: 4.2},
                {question: "10a. Overall mission fulfillment", score: 4.3},
                {question: "6b. Cell group - love God", score: 4.3},
                {question: "7b. Missions show God's love", score: 4.1},
                {question: "2a. Worship encounter God", score: 4.4},
                {question: "3b. Practical faith help", score: 4.4},
                {question: "4b. Children ministry - love God", score: 4.2},
                {question: "9b. Christian education", score: 4.2},
                {question: "2c. Worship meaningful visitors", score: 4.1},
                {question: "5b. Youth ministry - love God", score: 3.8}
            ],
            
            distribution: {
                questions: [
                    "Hospitality Welcome", "Worship Experience", "Preaching Quality", 
                    "Children Ministry", "Youth Ministry", "Cell Groups", 
                    "After-Service", "Missions", "Care Ministries", "Christian Education"
                ],
                ratings: {
                    1: [8, 6, 3, 5, 12, 7, 15, 9, 8, 7],
                    2: [12, 10, 6, 8, 18, 14, 22, 12, 11, 10],
                    3: [35, 32, 23, 25, 38, 40, 53, 30, 34, 32],
                    4: [85, 82, 85, 71, 65, 72, 68, 75, 78, 80],
                    5: [77, 87, 100, 50, 35, 36, 59, 51, 86, 88]
                }
            },
            
            // Ministry Participation by Age Group
            ageMinistryParticipation: {
                ministries: ["Children Ministry", "Youth Ministry", "Missions", "Cell Group", "Christian Education"],
                ageGroups: {
                    "18-29": [25, 45, 40, 75, 35],
                    "30-44": [65, 40, 55, 80, 50],
                    "45-59": [35, 50, 60, 85, 45],
                    "60+": [15, 10, 35, 70, 40]
                }
            },
            
            // Ministry Participation by Years in Church
            yearsMinistryParticipation: {
                ministries: ["Children Ministry", "Youth Ministry", "Missions", "Cell Group", "Christian Education"],
                yearsGroups: {
                    "<1 year": [35, 25, 45, 40, 45],
                    "1-5 years": [55, 40, 60, 65, 50],
                    "6-10 years": [45, 50, 65, 80, 55],
                    "10+ years": [30, 35, 70, 85, 65]
                }
            },
            
            ageComparison: {
                categories: ["Worship", "Preaching", "Cell Group", "Missions", "Hospitality", "Overall"],
                groups: {
                    "18-29": [4.1, 4.3, 4.3, 4.0, 4.3, 4.1],
                    "30-44": [4.4, 4.5, 4.4, 4.4, 4.2, 4.4],
                    "45-59": [4.3, 4.4, 4.5, 4.3, 4.1, 4.3],
                    "60+": [4.4, 4.3, 4.7, 4.1, 4.3, 4.4]
                }
            },
            
            genderComparison: {
                categories: ["Worship", "Preaching", "Cell Group", "Hospitality", "Overall"],
                male: [4.2, 4.4, 4.3, 4.2, 4.2],
                female: [4.5, 4.5, 4.5, 4.4, 4.5]
            },
            
            yearsComparison: {
                categories: ["Worship", "Preaching", "Cell Group", "Hospitality", "Overall"],
                "<1 year": [4.2, 4.4, 4.1, 4.3, 4.3],
                "1-5 years": [4.3, 4.5, 4.4, 4.2, 4.4],
                "6-10 years": [4.2, 4.3, 4.5, 4.1, 4.3],
                "10+ years": [4.4, 4.4, 4.6, 4.3, 4.4]
            }
        };

        // Create charts using Plotly (from first file)
        function createCharts() {
            // Mean Scores Chart
            const meanTrace = {
                x: surveyData.meanScores.map(d => d.score),
                y: surveyData.meanScores.map(d => d.question),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: surveyData.meanScores.map(d => 
                        d.score >= 4.5 ? '#2ecc71' :
                        d.score >= 4.0 ? '#3498db' :
                        d.score >= 3.5 ? '#f39c12' : '#e74c3c'
                    )
                },
                text: surveyData.meanScores.map(d => d.score.toFixed(1)),
                textposition: 'auto',
                hoverinfo: 'x+y'
            };

            const meanLayout = {
                title: '',
                xaxis: { 
                    title: 'Average Score (1-5)', 
                    range: [3, 5],
                    gridcolor: '#f0f0f0'
                },
                yaxis: { 
                    title: '',
                    tickfont: { size: 10 }
                },
                margin: { l: 200, r: 50, t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                hoverlabel: { bgcolor: '#fff', bordercolor: '#667eea' }
            };

            Plotly.newPlot('meanChart', [meanTrace], meanLayout, {displayModeBar: true, responsive: true});

            // Distribution Chart - Convert counts to percentages for 217 responses
            const distributionTraces = [1, 2, 3, 4, 5].map(rating => {
                const percentages = surveyData.distribution.ratings[rating].map(count => 
                    (count / 217 * 100).toFixed(1)
                );
                return {
                    x: percentages,
                    y: surveyData.distribution.questions,
                    name: `Rating ${rating}`,
                    type: 'bar',
                    orientation: 'h',
                    text: percentages.map(p => p + '%'),
                    textposition: 'auto',
                    marker: {
                        color: rating === 5 ? '#2ecc71' :
                               rating === 4 ? '#3498db' :
                               rating === 3 ? '#f39c12' :
                               rating === 2 ? '#e67e22' : '#e74c3c'
                    }
                };
            });

            const distributionLayout = {
                title: '',
                barmode: 'stack',
                xaxis: { 
                    title: 'Percentage of Responses', 
                    ticksuffix: '%',
                    range: [0, 100]
                },
                yaxis: { 
                    title: '',
                    tickfont: { size: 10 }
                },
                margin: { l: 180, r: 50, t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                legend: { 
                    orientation: 'h', 
                    y: -0.3,
                    x: 0.5,
                    xanchor: 'center'
                }
            };

            Plotly.newPlot('distributionChart', distributionTraces, distributionLayout, {displayModeBar: true, responsive: true});

            // Ministry Participation by Age Group Chart - HORIZONTAL
            const ageGroups = Object.keys(surveyData.ageMinistryParticipation.ageGroups);
            const ageMinistryTraces = surveyData.ageMinistryParticipation.ministries.map((ministry, index) => {
                const values = Object.values(surveyData.ageMinistryParticipation.ageGroups).map(group => group[index]);
                return {
                    y: ageGroups,
                    x: values,
                    name: ministry,
                    type: 'bar',
                    orientation: 'h',
                    text: values.map(v => v + '%'),
                    textposition: 'auto',
                    marker: {
                        color: index === 0 ? '#e74c3c' :
                               index === 1 ? '#3498db' :
                               index === 2 ? '#2ecc71' :
                               index === 3 ? '#f39c12' : '#9b59b6'
                    }
                };
            });

            const ageMinistryLayout = {
                title: '',
                xaxis: { title: 'Participation Rate (%)', range: [0, 100] },
                yaxis: { title: 'Age Group' },
                barmode: 'group',
                margin: { l: 120, r: 30, t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('ageMinistryChart', ageMinistryTraces, ageMinistryLayout, {displayModeBar: true, responsive: true});

            // Ministry Participation by Years in Church Chart - HORIZONTAL
            const yearsGroups = Object.keys(surveyData.yearsMinistryParticipation.yearsGroups);
            const yearsMinistryTraces = surveyData.yearsMinistryParticipation.ministries.map((ministry, index) => {
                const values = Object.values(surveyData.yearsMinistryParticipation.yearsGroups).map(group => group[index]);
                return {
                    y: yearsGroups,
                    x: values,
                    name: ministry,
                    type: 'bar',
                    orientation: 'h',
                    text: values.map(v => v + '%'),
                    textposition: 'auto',
                    marker: {
                        color: index === 0 ? '#e74c3c' :
                               index === 1 ? '#3498db' :
                               index === 2 ? '#2ecc71' :
                               index === 3 ? '#f39c12' : '#9b59b6'
                    }
                };
            });

            const yearsMinistryLayout = {
                title: '',
                xaxis: { title: 'Participation Rate (%)', range: [0, 100] },
                yaxis: { title: 'Years in Church' },
                barmode: 'group',
                margin: { l: 140, r: 30, t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('yearsMinistryChart', yearsMinistryTraces, yearsMinistryLayout, {displayModeBar: true, responsive: true});

            // Age Comparison Chart
            const ageTraces = Object.keys(surveyData.ageComparison.groups).map(ageGroup => ({
                x: surveyData.ageComparison.categories,
                y: surveyData.ageComparison.groups[ageGroup],
                name: ageGroup,
                type: 'bar',
                marker: {
                    color: ageGroup === '18-29' ? '#e74c3c' :
                           ageGroup === '30-44' ? '#3498db' :
                           ageGroup === '45-59' ? '#2ecc71' : '#f39c12'
                }
            }));

            const ageLayout = {
                title: '',
                xaxis: { title: '' },
                yaxis: { 
                    title: 'Average Score', 
                    range: [3.5, 5],
                    gridcolor: '#f0f0f0'
                },
                margin: { t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('ageChart', ageTraces, ageLayout, {displayModeBar: true, responsive: true});

            // Gender Comparison Chart
            const genderTraces = [
                {
                    x: surveyData.genderComparison.categories,
                    y: surveyData.genderComparison.male,
                    name: 'Male',
                    type: 'bar',
                    marker: { color: '#3498db' }
                },
                {
                    x: surveyData.genderComparison.categories,
                    y: surveyData.genderComparison.female,
                    name: 'Female',
                    type: 'bar',
                    marker: { color: '#e91e63' }
                }
            ];

            const genderLayout = {
                title: '',
                xaxis: { title: '' },
                yaxis: { 
                    title: 'Average Score', 
                    range: [3.5, 5],
                    gridcolor: '#f0f0f0'
                },
                margin: { t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('genderChart', genderTraces, genderLayout, {displayModeBar: true, responsive: true});

            // Years Comparison Chart
            const yearsTraces = Object.keys(surveyData.yearsComparison).filter(key => key !== 'categories').map(years => ({
                x: surveyData.yearsComparison.categories,
                y: surveyData.yearsComparison[years],
                name: years,
                type: 'bar',
                marker: {
                    color: years === '<1 year' ? '#e74c3c' :
                           years === '1-5 years' ? '#3498db' :
                           years === '6-10 years' ? '#2ecc71' : '#f39c12'
                }
            }));

            const yearsLayout2 = {
                title: '',
                xaxis: { title: '' },
                yaxis: { 
                    title: 'Average Score', 
                    range: [3.5, 5],
                    gridcolor: '#f0f0f0'
                },
                margin: { t: 30, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('yearsChart', yearsTraces, yearsLayout2, {displayModeBar: true, responsive: true});
        }

        // Download dashboard as image
        function downloadAsImage() {
            const button = document.querySelector('.download-btn');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            loadingText.textContent = 'Generating Image...';
            loadingOverlay.style.display = 'flex';
            
            // Hide the download dropdown
            const dropdown = document.getElementById('downloadDropdown');
            dropdown.classList.remove('show');
            
            // Create a container for all sections
            const content = document.createElement('div');
            content.style.backgroundColor = '#667eea';
            content.style.padding = '20px';
            
            // Clone all sections
            const sections = document.querySelectorAll('.section');
            const header = document.querySelector('.header').cloneNode(true);
            
            content.appendChild(header);
            sections.forEach(section => {
                content.appendChild(section.cloneNode(true));
            });

            html2canvas(content, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#667eea'
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'church-of-praise-survey-report-2025.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                loadingOverlay.style.display = 'none';
            }).catch(error => {
                console.error('Error generating image:', error);
                loadingOverlay.style.display = 'none';
                alert('Error generating image. Please try again.');
            });
        }

        // Download dashboard as PDF
        function downloadAsPDF() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            loadingText.textContent = 'Generating PDF...';
            loadingOverlay.style.display = 'flex';
            
            // Hide the download dropdown
            const dropdown = document.getElementById('downloadDropdown');
            dropdown.classList.remove('show');
            
            // Create a container for all sections
            const content = document.createElement('div');
            content.style.backgroundColor = '#667eea';
            content.style.padding = '20px';
            
            // Clone all sections
            const sections = document.querySelectorAll('.section');
            const header = document.querySelector('.header').cloneNode(true);
            
            content.appendChild(header);
            sections.forEach(section => {
                content.appendChild(section.cloneNode(true));
            });

            html2canvas(content, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: '#667eea'
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('church-of-praise-survey-report-2025.pdf');
                loadingOverlay.style.display = 'none';
            }).catch(error => {
                console.error('Error generating PDF:', error);
                loadingOverlay.style.display = 'none';
                alert('Error generating PDF. Please try again.');
            });
        }

        // Toggle download options dropdown
        function toggleDownloadOptions() {
            const dropdown = document.getElementById('downloadDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('downloadDropdown');
            const button = document.querySelector('.download-btn');
            
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', createCharts);
        window.addEventListener('resize', () => {
            // Redraw to ensure proper responsiveness on orientation change or resize
            createCharts();
        });
    </script>
</body>
</html>
